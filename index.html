<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Angular Radial Blur - Mask Method</title>
<style>
body {margin:20px;font-family:system-ui;}
canvas {border:1px solid #ccc;display:block;margin-bottom:20px;}
label {margin-left:10px;}
input[type=range]{-webkit-appearance:none;width:900px;height:8px;background:#ddd;border-radius:4px;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:#333;border-radius:50%;cursor:pointer;}
</style>
</head>
<body>

<canvas id="c" width="500" height="500"></canvas>

<div>
<input type="range" id="rotation" min="0" max="360" value="0" step="0.5">
<label>Rotation: <span id="rotVal">0</span>Â°</label>
</div>
<div>
<input type="range" id="maxBlur" min="0" max="12" value="4" step="0.1">
<label>Max Blur: <span id="blurVal">4</span>px</label>
</div>

<script>
const RAW="https://raw.githubusercontent.com/kiaraoptometrypx/RX_exam/main/fan_chart.png";
const canvas=document.getElementById("c"), ctx=canvas.getContext("2d");
const w=canvas.width, h=canvas.height, cx=w/2, cy=h/2;

let rotationDeg=0, maxBlur=4;

// Load base image
const img=new Image();
img.crossOrigin="anonymous"; img.src=RAW;

// Create angular blur mask
const maskCanvas=document.createElement("canvas");
maskCanvas.width=w; maskCanvas.height=h;
const maskCtx=maskCanvas.getContext("2d");

function createMask(){
  const imgData=maskCtx.createImageData(w,h);
  const data=imgData.data;
  for(let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      const idx=(y*w+x)*4;
      const dx=x-cx, dy=y-cy;
      let theta=Math.atan2(dy,dx);
      let v=(Math.cos(2*theta)+1)/2; // strongest blur at 3/9 o'clock
      v=Math.pow(v,0.75); // gamma for smoothness
      let alpha=Math.round(v*255);
      data[idx]=data[idx+1]=data[idx+2]=0;
      data[idx+3]=alpha;
    }
  }
  maskCtx.putImageData(imgData,0,0);
}

function draw(){
  ctx.clearRect(0,0,w,h);

  // Draw base image
  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(rotationDeg*Math.PI/180);
  ctx.translate(-cx,-cy);
  ctx.drawImage(img,0,0,w,h);
  ctx.restore();

  // Apply blur overlay using mask
  ctx.save();
  ctx.filter=`blur(${maxBlur}px)`;
  ctx.globalCompositeOperation="source-over";
  ctx.drawImage(maskCanvas,0,0);
  ctx.restore();
}

img.onload=()=>{
  createMask();
  draw();
}

// Rotation slider
document.getElementById("rotation").addEventListener("input", e=>{
  rotationDeg=+e.target.value;
  document.getElementById("rotVal").textContent=rotationDeg;
  draw();
});

// Max blur slider
document.getElementById("maxBlur").addEventListener("input", e=>{
  maxBlur=+e.target.value;
  document.getElementById("blurVal").textContent=maxBlur;
  draw();
});
</script>
</body>
</html>
