<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Angular Radial Blur - Rotatable Mask</title>
<style>
body {margin:20px;font-family:system-ui;}
canvas {border:1px solid #ccc; display:block; margin-bottom:20px;}
label {margin-left:10px;}
input[type=range]{-webkit-appearance:none;width:500px;height:8px;background:#ddd;border-radius:4px;}
input[type=range]::-webkit-slider-thumb{-webkit-appearance:none;width:18px;height:18px;background:#333;border-radius:50%;cursor:pointer;}
</style>
</head>
<body>

<canvas id="c" width="500" height="500"></canvas>

<div>
<input type="range" id="rotation" min="0" max="360" value="0" step="0.5">
<label>Rotation: <span id="rotVal">0</span>Â°</label>
</div>
<div>
<input type="range" id="maxBlur" min="0" max="20" value="8" step="0.1">
<label>Max Blur: <span id="blurVal">8</span>px</label>
</div>

<script>
const RAW="https://raw.githubusercontent.com/kiaraoptometrypx/RX_exam/main/fan_chart.png";
const canvas=document.getElementById("c"), ctx=canvas.getContext("2d");
const w=canvas.width,h=canvas.height,cx=w/2,cy=h/2;

let rotationDeg=0, maxBlur=8;

// Base image
const img=new Image();
img.crossOrigin="anonymous"; img.src=RAW;

// Create mask canvas
const maskCanvas=document.createElement("canvas");
maskCanvas.width=w; maskCanvas.height=h;
const maskCtx=maskCanvas.getContext("2d");

function createMask(){
  const imgData=maskCtx.createImageData(w,h);
  const data=imgData.data;
  for(let y=0;y<h;y++){
    for(let x=0;x<w;x++){
      const idx=(y*w+x)*4;
      const dx=x-cx, dy=y-cy;
      let theta=Math.atan2(dy,dx);

      // New smoother angular distribution
      let v=(Math.cos(2*theta)+1)/2; 
      v=Math.pow(v,0.5);   // lower gamma = smoother steps
      v = Math.min(Math.max(v,0),1); // clamp 0-1

      data[idx]=255;       
      data[idx+1]=255;
      data[idx+2]=255;
      data[idx+3]=Math.round(v*255); // alpha controls blur intensity
    }
  }
  maskCtx.putImageData(imgData,0,0);
}

function draw(){
  ctx.clearRect(0,0,w,h);
  ctx.drawImage(img,0,0,w,h);

  ctx.save();
  ctx.translate(cx,cy);
  ctx.rotate(rotationDeg*Math.PI/180);
  ctx.translate(-cx,-cy);

  // Stronger blur with smooth transition
  ctx.filter=`blur(${maxBlur}px)`;
  ctx.globalCompositeOperation="destination-in";
  ctx.drawImage(maskCanvas,0,0);
  ctx.restore();

  ctx.globalCompositeOperation="source-over";
  ctx.filter="none";
}

img.onload=()=>{
  createMask();
  draw();
}

// Sliders
document.getElementById("rotation").addEventListener("input", e=>{
  rotationDeg=+e.target.value;
  document.getElementById("rotVal").textContent=rotationDeg;
  draw();
});

document.getElementById("maxBlur").addEventListener("input", e=>{
  maxBlur=+e.target.value;
  document.getElementById("blurVal").textContent=maxBlur;
  draw();
});
</script>
</body>
</html>
