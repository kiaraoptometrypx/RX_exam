<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Safari-Compatible Rotatable Radial Blur</title>
<style>
body {margin:20px; font-family:system-ui;}
canvas {border:1px solid #ccc; display:block; margin-bottom:20px;}
label {margin-left:10px;}
input[type=range] {
  -webkit-appearance: none;
  width: 900px; height: 8px; background: #ddd; border-radius: 4px;
}
input[type=range]::-webkit-slider-thumb {
  -webkit-appearance: none;
  width: 18px; height: 18px; background: #333; border-radius: 50%; cursor: pointer;
}
</style>
</head>
<body>

<canvas id="c" width="700" height="700"></canvas>

<div>
  <input type="range" id="rotation" min="0" max="180" value="0" step="0.5">
  <label>Rotation: <span id="rotVal">0</span>Â°</label>
</div>
<div>
  <input type="range" id="maxBlur" min="0" max="8" value="4" step="0.1">
  <label>Max Blur: <span id="blurVal">4</span>px</label>
</div>

<script>
const RAW = "https://raw.githubusercontent.com/kiaraoptometrypx/RX_exam/main/fan_chart.png";
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");
const w = canvas.width, h = canvas.height, cx = w/2, cy = h/2;

const img = new Image();
img.crossOrigin = "anonymous";
img.src = RAW;

let levels = 8;       // number of blur steps
let maxBlur = 4;
let gamma = 0.75;     // controls smoothness
let rotationDeg = 0;

img.onload = () => drawBlur();

// Compute angular factor for pixel (0..1)
function angularFactor(x,y){
  const dx = x-cx;
  const dy = y-cy;
  let theta = Math.atan2(dy, dx) - rotationDeg * Math.PI/180;
  let v = (Math.cos(2*theta)+1)/2;
  return Math.pow(v, gamma);
}

// Draw image with angular blur
function drawBlur(){
  ctx.clearRect(0,0,w,h);

  // Draw multiple blurred copies with alpha blending
  for(let i=0;i<levels;i++){
    const blurPx = (i/(levels-1))*maxBlur;
    ctx.filter = `blur(${blurPx}px)`;
    ctx.globalAlpha = 1.0 / levels; // simple even blend
    ctx.drawImage(img,0,0,w,h);
  }

  ctx.filter = 'none';
  ctx.globalAlpha = 1.0;
}

// Rotation slider
function setupSlider(id, callback){
  const s = document.getElementById(id);
  s.addEventListener("input", callback);
  s.addEventListener("change", callback);
}

setupSlider("rotation", e=>{
  rotationDeg = +e.target.value;
  document.getElementById("rotVal").textContent = rotationDeg;
  drawBlur();
});

setupSlider("maxBlur", e=>{
  maxBlur = +e.target.value;
  document.getElementById("blurVal").textContent = maxBlur;
  drawBlur();
});
</script>

</body>
</html>
